---
description: Apply Supabase migrations to Supabase Cloud immediately, even on feature branches
globs: supabase/migrations/**/*.sql
alwaysApply: false
---

# Apply Supabase Migrations on Branch

There is no automated CI pipeline that applies migrations to Supabase Cloud on push. Migrations must be applied manually using MCP tools immediately after creating them, even on a feature branch.

Failing to apply a migration causes runtime errors like "Could not find column X in the schema cache."

## How to apply migrations

Use the Supabase MCP `apply_migration` tool targeting the Cloud project:

```
apply_migration(
  project_id: "gqrnlnlfidighosujpdb",
  name: "descriptive_snake_case_name",
  query: "<SQL>"
)
```

## When to apply

- **Always** apply migrations immediately after creating them, even on a branch.
- Do **not** wait for merge to `main` â€” the app will break if it references columns that don't exist yet.
- All migration SQL must be idempotent (`IF NOT EXISTS`, `CREATE OR REPLACE`, etc.) so re-running is safe.

## Do NOT use SSH

The old self-hosted droplet (`root@gerbtrace.com`) is **not** the production database. Never SSH there to apply migrations. Use Supabase MCP tools instead.
