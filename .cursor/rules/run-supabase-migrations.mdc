---
description: How to apply Supabase migrations to Supabase Cloud
globs: supabase/migrations/**/*.sql
alwaysApply: false
---

# Running Supabase Migrations on Supabase Cloud

When a new migration file is created under `supabase/migrations/`, apply it to **Supabase Cloud** using MCP tools. Do NOT use SSH to the old droplet â€” the droplet database is no longer production.

## Supabase Cloud project

- **Project ID:** `gqrnlnlfidighosujpdb`

## Step-by-step

1. **Create the migration file** in `supabase/migrations/` with a timestamped name.

2. **Apply the migration** using the `apply_migration` MCP tool:

```
apply_migration(
  project_id: "gqrnlnlfidighosujpdb",
  name: "descriptive_snake_case_name",
  query: "<SQL from the migration file>"
)
```

3. **Verify** the migration was applied:

```
execute_sql(
  project_id: "gqrnlnlfidighosujpdb",
  query: "SELECT column_name, data_type FROM information_schema.columns WHERE table_schema='public' AND table_name='<table>';"
)
```

## Important notes

- All DDL statements must be **idempotent** (`IF NOT EXISTS`, `CREATE OR REPLACE`, etc.).
- Supabase Cloud automatically reloads the PostgREST schema cache after `apply_migration`.
- The deploy workflow (`.github/workflows/deploy-supabase.yml`) is disabled for the legacy droplet. Migrations are applied via MCP tools or the Supabase dashboard.
- If a migration produces `NOTICE: ... already exists, skipping` that is fine.
