---
title: Release Process
description: Deployment architecture, environment variables, CI/CD workflows, release checklist, and operational safety.
---

# Release Process

Gerbtrace has three deployable surfaces:

- **Web app** — a Nuxt app deployed on **Cloudflare Workers** (`gerbtrace.com`)
- **Desktop app** — Tauri 2 builds for macOS/Windows shipped via **GitHub Releases** with the Tauri updater
- **API server** — **Supabase Cloud** project `gqrnlnlfidighosujpdb` at `[REDACTED]`

## Environment variables

For local development, copy `.env.example` to `.env` and set:

- **`SUPABASE_URL`** — `[REDACTED]`
- **`SUPABASE_ANON_KEY`** — Supabase anon key (JWT)

The Nuxt runtime config also accepts `NUXT_PUBLIC_SUPABASE_URL` and `NUXT_PUBLIC_SUPABASE_ANON_KEY` (same values). Never commit `.env` (it is gitignored). Treat service-role keys and SMTP credentials as secrets.

## Version bump

Update the version in all four files:

1. `package.json` – `"version"`
2. `src-tauri/tauri.conf.json` – `"version"`
3. `src-tauri/Cargo.toml` – `version`
4. `nuxt.config.ts` – `runtimeConfig.public.appVersion`

All four must match for the release to be consistent.

## Tag and release

```bash
git add -A && git commit -m "Release vX.Y.Z"
git tag vX.Y.Z
git push origin vX.Y.Z
```

GitHub Actions automatically builds macOS and Windows installers and creates a GitHub Release when a `v*` tag is pushed.

## Release notes

Every release includes short, user-oriented release notes on the [GitHub Releases](https://github.com/newmatik/gerbtrace/releases) page. Guidelines:

- Use the bare version number as the release title (e.g., `v1.1.1`)
- Use a flat bullet list with concise sentences
- Focus on new features and bug fixes that affect users
- No emojis, no internal details, no auto-generated contributor lists

The same text appears in the desktop app's "What's New" dialog after an auto-update.

## CI/CD workflows

| Workflow | Trigger | Action |
|---|---|---|
| `ci.yml` | Pull request to `main` | Type check + build verification |
| `deploy.yml` | Push to `main` | Deploy web app to Cloudflare Workers |
| `build-desktop.yml` | Tag push (`v*`) | Build macOS/Windows apps + create GitHub Release |

### Web deployment

Triggered on every push to `main` (ignores `supabase/**` and `src-tauri/**` changes):

1. `pnpm install --frozen-lockfile` and web build with environment variables
2. Deploy the app via Cloudflare Workers build/deploy pipeline
3. Optional cache purge in Cloudflare dashboard when needed

### Desktop release

Triggered on `v*` tag push:

1. Matrix build for macOS (universal binary) and Windows
2. macOS: Apple certificate import, keychain setup, notarization
3. Windows: standard build
4. Creates GitHub Release with installers and `latest.json` for the updater
5. Signs updater artifacts with the Tauri signing key

### API deployment

Database migrations are applied directly to **Supabase Cloud** (project `gqrnlnlfidighosujpdb`) using the Supabase MCP tools (`apply_migration`, `execute_sql`).

Edge functions are deployed via the Supabase dashboard or CLI.

## GitHub secrets

### Web deploy (`deploy.yml`)

- **`CLOUDFLARE_API_TOKEN`**, **`CLOUDFLARE_ACCOUNT_ID`** (if required by workflow)
- **`SENTRY_DSN`**, (optional) **`SENTRY_AUTH_TOKEN`** for source maps

### Desktop builds (`build-desktop.yml`)

Updater signing:

- **`TAURI_SIGNING_PRIVATE_KEY`**, **`TAURI_SIGNING_PRIVATE_KEY_PASSWORD`**

Runtime config:

- **`SUPABASE_ANON_KEY`** (URL is fixed in workflows)

Apple signing / notarization (macOS):

- **`APPLE_CERTIFICATE`**, **`APPLE_CERTIFICATE_PASSWORD`**, **`KEYCHAIN_PASSWORD`**
- **`APPLE_SIGNING_IDENTITY`**
- **`APPLE_API_ISSUER`**, **`APPLE_API_KEY`**, **`APPLE_API_KEY_CONTENT`**

Use the setup scripts to configure secrets:

- `scripts/setup-github-secrets.sh` — Tauri signing keypair
- `scripts/setup-apple-signing.sh` — Apple certificate and notarization
- `scripts/set-sentry-secrets.mjs` — Sentry DSN and auth token

## Updater signing

The desktop auto-updater verifies signatures to ensure update integrity:

- The public key in `src-tauri/tauri.conf.json` (`plugins.updater.pubkey`) must match the private key used in CI
- If desktop builds fail with `incorrect updater private key password`, rotate/update the keypair and secrets

## Supabase migration review

If the release includes new SQL migrations, verify before merging:

- [ ] Every `CREATE TABLE` uses `IF NOT EXISTS`
- [ ] Every `CREATE FUNCTION` uses `CREATE OR REPLACE`
- [ ] Every `ALTER TABLE ADD COLUMN` uses `IF NOT EXISTS`
- [ ] Every `ALTER TABLE ADD CONSTRAINT` checks `pg_constraint` before adding
- [ ] Every `CREATE POLICY` is guarded against re-creation
- [ ] Dedup `DELETE` statements use `row_number()` with a stable tiebreaker
- [ ] No statement depends on `postgres` being able to `SET ROLE supabase_admin`
- [ ] No statement requires table/function ownership that `supabase_admin` does not have

## Verification checklist

After a release:

- [ ] **Web**: `deploy.yml` succeeded after merge to `main`
- [ ] **Web**: footer version matches the release version
- [ ] **Desktop**: `build-desktop.yml` succeeded for both `macos-latest` and `windows-latest`
- [ ] **Desktop**: GitHub Release has both macOS and Windows installers
- [ ] **Desktop**: auto-updater picks up the new version
- [ ] **Supabase**: migrations applied (confirm via `execute_sql` or Supabase dashboard)

If the web footer shows an old version after deploy, purge cache in the Cloudflare dashboard (**Caching > Configuration > Purge Everything**).

## Operational safety

- Never paste private keys into PRs, issues, or chat. Treat pasted keys as compromised and rotate them.
- Keep deploy keys scoped and rotate periodically.
- Confirm Actions logs do not contain secret material.

## Historical failure log

| Release | Failure | Root cause |
|---|---|---|
| v1.0.6 | Initial schema fails on provisioned DB | Migration not idempotent |
| v1.0.6 | `set -e` kills script on expected errors | Error handling too strict |
| v1.0.9 | `must be owner of function` | postgres cannot replace function owned by supabase_admin |
| v1.0.10 | `must be owner of table` | postgres cannot ALTER tables owned by supabase_admin |
| v1.0.10 | `permission denied to set role` | postgres cannot SET ROLE to supabase_admin |

## Sample data

The project ships with sample Arduino UNO Gerber files for demo purposes. The "Try a Sample" button on the landing page loads these files so users can explore without importing their own data.
