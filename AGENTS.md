# Gerbtrace — Agent Instructions

## Cursor Cloud-specific instructions

### Product overview

Gerbtrace is a Nuxt 4 SPA (SSR disabled) for viewing/comparing Gerber PCB files and managing manufacturing data. The core Gerber viewer is fully client-side; team/collaboration features require Supabase.

### Key commands

| Task | Command |
|---|---|
| Install deps | `pnpm install` (runs `nuxt prepare` and `simple-git-hooks` via postinstall) |
| Typecheck | `pnpm run typecheck` |
| Tests | `pnpm run test` |
| Dev server | `CHOKIDAR_USEPOLLING=1 CHOKIDAR_INTERVAL=400 pnpm exec nuxt dev --no-fork` (or `pnpm run dev` which also runs precommit) |
| Build | `pnpm run build` |

### Dev server startup notes

- `pnpm run dev` runs `precommit` (manifest build + typecheck) before starting the dev server. To skip this during iterative dev, start the server directly: `CHOKIDAR_USEPOLLING=1 CHOKIDAR_INTERVAL=400 pnpm exec nuxt dev --no-fork --port 3000`.
- `cross-env` is a devDependency but not on the system PATH. Use `pnpm exec cross-env` or set env vars inline as shown above.
- The dev server takes ~30-45 seconds to be ready after starting. Check with `curl -s -o /dev/null -w "%{http_code}" http://localhost:3000/`.
- `@nuxtjs/mdc` dependency resolution warnings during startup are benign and do not affect functionality.

### Authentication

- Public routes: `/`, `/auth/*`, `/docs/*`. All other routes require Supabase auth.
- The Gerber viewer at `/viewer/[id]` and dashboard at `/dashboard` require login.
- Auth providers: Microsoft, GitHub, Magic Link (email). Configured via Supabase.
- To test authenticated flows, use the "Email & Password" mode on `/auth/login` with `GERBTRACE_TEST_EMAIL` / `GERBTRACE_TEST_PASSWORD` secrets.

### Testing authenticated features

After login, the dashboard at `/dashboard` shows team projects. Click any project card to open the Gerber viewer at `/viewer/[id]?tab=pcb`. The viewer supports layer mode (default) and realistic rendering mode via the toolbar toggle.

### Pre-commit hook

`simple-git-hooks` runs `pnpm run precommit` which executes:
1. `pnpm run packages:manifest` — rebuilds package manifest JSON
2. `pnpm run packages:check` — validates package library
3. `pnpm run typecheck` — TypeScript validation

Commits are blocked if typecheck fails. Do not use `--no-verify` unless explicitly asked.

### Content/Docs

Nuxt Content v3 uses D1 (Cloudflare) in production and SQLite locally. The docs page may show "Docs are still loading" briefly after a dev server restart — this is normal and resolves on reload.

### Package library

`public/packages/` contains thousands of static JSON files (component package definitions). These are generated by scripts and ignored by Vite's file watcher to avoid exhausting fs.watch limits.
